<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>C Chord Trainer</title>
<style>
body{
  margin:0;
  background:#0f1115;
  color:#e6e9ef;
  font-family:system-ui,-apple-system,sans-serif;
}
.wrap{
  max-width:1040px;
  margin:40px auto;
  padding:28px;
  background:linear-gradient(180deg,#1b1f27,#141821);
  border-radius:18px;
}
h1{margin:0;font-size:28px}
.sub{opacity:.6;font-size:13px;margin-bottom:18px}
.main{display:grid;grid-template-columns:1fr 320px;gap:20px}

/* ---------- FRETBOARD ---------- */
svg{
  width:100%;
  height:380px;
  background:radial-gradient(120% 120% at 50% 0%,#242a35,#151a22);
  border-radius:14px;
}
.string{stroke:rgba(255,255,255,.28);stroke-width:2}
.fret{stroke:rgba(255,255,255,.15);stroke-width:2}
.dot{fill:#7ef0c4;stroke:#0c1b14;stroke-width:2}
.dotText{fill:#0c1b14;font-weight:900;font-size:14px;text-anchor:middle;dominant-baseline:middle}
.labelText{fill:rgba(255,255,255,.65);font-size:12px}
.open{fill:none;stroke:#7ef0c4;stroke-width:3}
.mute{fill:#f0c46a;font-size:14px;font-weight:900}

/* ---------- PANEL ---------- */
.panel{
  background:rgba(255,255,255,.04);
  border-radius:14px;
  padding:16px;
}
.codeName{font-size:30px;font-weight:900}
.tones{font-size:13px;opacity:.75;margin-bottom:14px}
.section{margin-bottom:14px}
.label{font-size:12px;opacity:.6;margin-bottom:6px}
.btns{display:flex;flex-wrap:wrap;gap:6px}
button{
  background:#222834;
  color:#e6e9ef;
  border:none;
  border-radius:999px;
  padding:7px 12px;
  font-size:13px;
  cursor:pointer;
}
button.active{
  background:#7ef0c4;
  color:#0c1b14;
  font-weight:800;
}
button.disabled{
  opacity:.4;
  pointer-events:none;
}
</style>
</head>

<body>
<div class="wrap">
  <h1>C</h1>
  <div class="sub">Triad + 7th + Extensions (정상 화성 구조)</div>

  <div class="main">
    <svg id="fretboard" viewBox="0 0 720 380"></svg>

    <div class="panel">
      <div class="codeName" id="codeName">C</div>
      <div class="tones" id="tones"></div>

      <div class="section">
        <div class="label">Triad</div>
        <div class="btns">
          <button id="majBtn" class="active">Major</button>
          <button id="minBtn">Minor</button>
        </div>
      </div>

      <div class="section">
        <div class="label">7th</div>
        <div class="btns">
          <button data-7="none" class="active">없음</button>
          <button data-7="b7">♭7</button>
          <button data-7="M7">M7</button>
        </div>
      </div>

      <div class="section">
        <div class="label">Extensions</div>
        <div class="btns">
          <button id="add9Btn">add9</button>
          <button data-ext="9">9</button>
          <button data-ext="11">11</button>
          <button data-ext="13">13</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------- STATE ---------- */
const state={
  triad:"maj",
  seventh:"none",
  add9:false,
  ext:null
};

/* ---------- VOICINGS (C 기준 최소 DB) ---------- */
const VOICINGS={
  "C":      {shape:["x",3,2,0,1,0], fingers:[0,3,2,0,1,0]},
  "Cm":     {shape:["x",3,1,0,1,3], fingers:[0,3,1,0,1,4]},
  "C7":     {shape:["x",3,2,3,1,0], fingers:[0,3,2,4,1,0]},
  "CM7":    {shape:["x",3,2,0,0,0], fingers:[0,3,2,0,0,0]},
  "Cm7":    {shape:["x",3,1,3,1,3], fingers:[0,3,1,4,1,4]},
  "C9":     {shape:["x",3,2,3,3,3], fingers:[0,1,2,3,3,3]},
  "Cm11":   {shape:["x",3,1,3,1,1], fingers:[0,3,1,4,1,1]},
  "C13":    {shape:["x",3,2,3,5,5], fingers:[0,1,2,3,4,4]}
};

/* ---------- AUTO 7 ---------- */
function applyAuto7(){
  if(state.ext!==null){
    state.seventh="b7";
  }
}

/* ---------- QUALITY KEY ---------- */
function qualityKey(){
  let k="C";
  if(state.triad==="min") k+="m";

  if(state.ext!==null){
    k+=state.ext;
  }else{
    if(state.seventh==="b7") k+="7";
    if(state.seventh==="M7") k+="M7";
    if(state.add9) k+="add9";
  }
  return k;
}

/* ---------- CHORD TONES ---------- */
function chordTones(){
  const t=["C", state.triad==="min"?"Eb":"E", "G"];
  if(state.seventh==="b7") t.push("Bb");
  if(state.seventh==="M7") t.push("B");
  if(state.add9||state.ext!==null) t.push("D");
  if(state.ext>=11) t.push("F");
  if(state.ext===13) t.push("A");
  return t;
}

/* ---------- FRETBOARD RENDER ---------- */
function drawFretboard(){
  const svg=document.getElementById("fretboard");
  svg.innerHTML="";
  const W=720,H=380,p=60;
  const strings=6,frets=9;
  const gx=(W-p*2)/frets;
  const gy=(H-p*2)/(strings-1);

  const labels=["1(e)","2(B)","3(G)","4(D)","5(A)","6(E)"];
  labels.forEach((l,i)=>{
    svg.innerHTML+=`<text x="20" y="${p+i*gy+4}" class="labelText">${l}</text>`;
  });

  for(let s=0;s<strings;s++){
    const y=p+s*gy;
    svg.innerHTML+=`<line x1="${p}" x2="${W-p}" y1="${y}" y2="${y}" class="string"/>`;
  }
  for(let f=0;f<=frets;f++){
    const x=p+f*gx;
    svg.innerHTML+=`<line x1="${x}" x2="${x}" y1="${p}" y2="${H-p}" class="fret"/>`;
  }

  const v=VOICINGS[qualityKey()];
  if(!v) return;

  v.shape.forEach((fret,i)=>{
    const y=p+i*gy;
    if(fret==="x"){
      svg.innerHTML+=`<text x="${p-30}" y="${y+5}" class="mute">X</text>`;
    }else if(fret===0){
      svg.innerHTML+=`<circle cx="${p-20}" cy="${y}" r="6" class="open"/>`;
    }else{
      const x=p+(fret-0.5)*gx;
      svg.innerHTML+=`
        <circle cx="${x}" cy="${y}" r="14" class="dot"/>
        <text x="${x}" y="${y+1}" class="dotText">${v.fingers[i]}</text>`;
    }
  });
}

/* ---------- RENDER ---------- */
function render(){
  applyAuto7();
  const key=qualityKey();
  document.getElementById("codeName").innerText=key;
  document.getElementById("tones").innerText=
    "Chord tones: "+chordTones().join(" – ");
  drawFretboard();
}

/* ---------- EVENTS ---------- */
majBtn.onclick=()=>{state.triad="maj";majBtn.classList.add("active");minBtn.classList.remove("active");render();}
minBtn.onclick=()=>{state.triad="min";minBtn.classList.add("active");majBtn.classList.remove("active");render();}

document.querySelectorAll("[data-7]").forEach(b=>{
  b.onclick=()=>{state.seventh=b.dataset["7"];render();}
});

add9Btn.onclick=()=>{
  if(state.ext!==null) return;
  state.add9=!state.add9;
  add9Btn.classList.toggle("active",state.add9);
  render();
};

document.querySelectorAll("[data-ext]").forEach(b=>{
  b.onclick=()=>{
    const v=b.dataset.ext;
    state.ext=(state.ext===v?null:v);
    document.querySelectorAll("[data-ext]").forEach(x=>x.classList.remove("active"));
    if(state.ext) b.classList.add("active");
    render();
  };
});

render();
</script>
</body>
</html>
