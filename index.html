<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>C Chord Trainer</title>
<style>
  body{
    margin:0;
    background:#0f1115;
    color:#e6e9ef;
    font-family:system-ui,-apple-system,sans-serif;
  }
  .wrap{
    max-width:1040px;
    margin:40px auto;
    padding:28px;
    background:linear-gradient(180deg,#1b1f27,#141821);
    border-radius:18px;
    box-shadow:0 30px 80px rgba(0,0,0,.35);
  }
  h1{margin:0;font-size:28px}
  /* ✅ 작은 글자 제거: sub는 남겨두되 숨김 처리 */
  .sub{display:none;}

  .main{display:grid;grid-template-columns:1fr 320px;gap:20px}

  /* ---------- FRETBOARD ---------- */
  svg{
    width:100%;
    height:400px;
    background:radial-gradient(120% 120% at 50% 0%,#242a35,#151a22);
    border-radius:14px;
  }
  .string{stroke:rgba(255,255,255,.28);stroke-width:2}
  .fret{stroke:rgba(255,255,255,.15);stroke-width:2}
  .dot{fill:#7ef0c4;stroke:#0c1b14;stroke-width:2}
  .dotText{fill:#0c1b14;font-weight:900;font-size:14px;text-anchor:middle;dominant-baseline:middle}
  .labelText{fill:rgba(255,255,255,.65);font-size:12px}
  .fretNum{fill:rgba(255,255,255,.55);font-size:12px;text-anchor:middle}
  .open{fill:none;stroke:#7ef0c4;stroke-width:3}
  .mute{fill:#f0c46a;font-size:14px;font-weight:900;text-anchor:middle;dominant-baseline:middle}

  /* ---------- PANEL ---------- */
  .panel{
    background:rgba(255,255,255,.04);
    border-radius:14px;
    padding:16px;
  }
  .codeName{font-size:30px;font-weight:900}
  .tones{font-size:13px;opacity:.75;margin-bottom:14px}
  .section{margin-bottom:14px}
  .label{font-size:12px;opacity:.6;margin-bottom:6px}
  .btns{display:flex;flex-wrap:wrap;gap:6px}
  button{
    background:#222834;
    color:#e6e9ef;
    border:none;
    border-radius:999px;
    padding:7px 12px;
    font-size:13px;
    cursor:pointer;
  }
  button.active{
    background:#7ef0c4;
    color:#0c1b14;
    font-weight:800;
  }
  button.disabled{
    opacity:.35;
    pointer-events:none;
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>C</h1>
  <div class="sub">숨김</div>

  <div class="main">
    <svg id="fretboard" viewBox="0 0 760 400"></svg>

    <div class="panel">
      <div class="codeName" id="codeName">C</div>
      <div class="tones" id="tones"></div>

      <div class="section">
        <div class="label">Triad</div>
        <div class="btns">
          <button id="majBtn" class="active">Major</button>
          <button id="minBtn">Minor</button>
        </div>
      </div>

      <div class="section">
        <div class="label">7th</div>
        <div class="btns" id="seventhBtns">
          <button data-7="none" class="active">없음</button>
          <button data-7="b7">♭7</button>
          <button data-7="M7">M7</button>
        </div>
      </div>

      <div class="section">
        <div class="label">Extensions</div>
        <div class="btns" id="extBtns">
          <button data-ext="none" class="active">없음</button>
          <button id="add9Btn">add9</button>
          <button data-ext="9">9</button>
          <button data-ext="11">11</button>
          <button data-ext="13">13</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/**
 * 모든 배열은 "1(e)→6(E)" 순서
 */

const state = {
  triad: "maj",
  seventh: "none",
  add9: false,
  ext: null
};

// shape/fingers: 1(e)→6(E)
const VOICINGS = {
  "C":      { shape:[0,1,0,2,3,"x"], fingers:[0,1,0,2,3,0] },
  "Cm":     { shape:[3,4,5,5,3,"x"], fingers:[1,2,4,4,1,0], barre:{fret:3, from:1, to:5, finger:1} },

  "C7":     { shape:[0,1,3,2,3,"x"], fingers:[0,1,3,2,4,0] },
  "CM7":    { shape:[0,0,0,2,3,"x"], fingers:[0,0,0,1,2,0] },
  "Cm7":    { shape:[3,4,3,5,3,"x"], fingers:[1,2,1,4,1,0], barre:{fret:3, from:1, to:5, finger:1} },

  "Cadd9":  { shape:[0,3,0,2,3,"x"], fingers:[0,4,0,2,3,0] },
  "C9":     { shape:[3,3,3,2,3,"x"], fingers:[3,3,4,1,2,0] },
  "Cm9":    { shape:[3,3,3,3,3,"x"], fingers:[1,1,1,1,1,0], barre:{fret:3, from:1, to:5, finger:1} },

  "Cm11":   { shape:[3,1,3,3,3,"x"], fingers:[2,1,3,4,4,0] },
  "C13":    { shape:[5,5,5,5,3,"x"], fingers:[2,3,4,4,1,0], barre:{fret:5, from:1, to:4, finger:1} }
};

function applyRules(){
  if(state.ext !== null){
    state.seventh = "b7";
    if(state.add9) state.add9 = false;
  }
}

function chordName(){
  let n="C";
  if(state.triad==="min") n+="m";

  if(state.ext!==null){
    n += state.ext;
    return n;
  }

  if(state.seventh==="b7") n+="7";
  if(state.seventh==="M7") n+="M7";
  if(state.add9) n+="add9";
  return n;
}

function chordTones(){
  const t=["C", state.triad==="min"?"Eb":"E", "G"];
  if(state.seventh==="b7") t.push("Bb");
  if(state.seventh==="M7") t.push("B");
  if(state.add9 || state.ext!==null) t.push("D");
  if(state.ext==="11" || state.ext==="13") t.push("F");
  if(state.ext==="13") t.push("A");
  return t;
}

function voicingKey(){
  const name = chordName();
  if(VOICINGS[name]) return name;

  if(state.ext!==null){
    const alt = "C" + (state.triad==="min"?"m":"") + state.ext;
    if(VOICINGS[alt]) return alt;
  }

  const alt7 = "C" + (state.triad==="min"?"m":"") +
    (state.seventh==="b7"?"7":(state.seventh==="M7"?"M7":""));
  if(VOICINGS[alt7]) return alt7;

  const tri = "C" + (state.triad==="min"?"m":"");
  if(VOICINGS[tri]) return tri;

  return "C";
}

function drawFretboard(){
  const svg=document.getElementById("fretboard");
  svg.innerHTML="";

  const W=760,H=400;
  const padL=120, padR=40, padT=55, padB=70;
  const strings=6, frets=9;

  const gridW=W-padL-padR;
  const gridH=H-padT-padB;
  const gx=gridW/frets;
  const gy=gridH/(strings-1);

  const labels=["1(e)","2(B)","3(G)","4(D)","5(A)","6(E)"];
  labels.forEach((l,i)=>{
    svg.innerHTML += `<text x="22" y="${padT+i*gy+4}" class="labelText">${l}</text>`;
  });

  for(let s=0;s<strings;s++){
    const y=padT+s*gy;
    svg.innerHTML += `<line x1="${padL}" x2="${W-padR}" y1="${y}" y2="${y}" class="string"/>`;
  }
  for(let f=0;f<=frets;f++){
    const x=padL+f*gx;
    svg.innerHTML += `<line x1="${x}" x2="${x}" y1="${padT}" y2="${padT+gridH}" class="fret"/>`;
  }
  for(let f=1;f<=frets;f++){
    const x=padL+(f-0.5)*gx;
    svg.innerHTML += `<text x="${x}" y="${H-28}" class="fretNum">${f}</text>`;
  }

  const key=voicingKey();
  const v=VOICINGS[key];
  if(!v) return;

  const oxX = padL - 45;

  if(v.barre){
    const {fret,from,to,finger}=v.barre;
    const x=padL+(fret-0.5)*gx;
    const y1=padT+(from-1)*gy;
    const y2=padT+(to-1)*gy;
    const h=Math.abs(y2-y1)+22;
    const y=Math.min(y1,y2)-11;

    svg.innerHTML += `
      <rect x="${x-13}" y="${y}" width="26" height="${h}" rx="13"
        fill="rgba(126,240,196,.25)" stroke="rgba(126,240,196,.7)" stroke-width="2"></rect>
      <text x="${x}" y="${y-8}" class="labelText">${finger}</text>
    `;
  }

  v.shape.forEach((fret,i)=>{
    const y=padT+i*gy;

    if(fret==="x"){
      svg.innerHTML += `<text x="${oxX}" y="${y}" class="mute">X</text>`;
      return;
    }
    if(fret===0){
      svg.innerHTML += `<circle cx="${oxX}" cy="${y}" r="6" class="open"></circle>`;
      return;
    }

    const x=padL+(fret-0.5)*gx;
    const finger=v.fingers[i]||0;

    svg.innerHTML += `
      <circle cx="${x}" cy="${y}" r="14" class="dot"></circle>
      <text x="${x}" y="${y+1}" class="dotText">${finger}</text>
    `;
  });
}

function syncUI(){
  majBtn.classList.toggle("active", state.triad==="maj");
  minBtn.classList.toggle("active", state.triad==="min");

  document.querySelectorAll("[data-7]").forEach(b=>{
    b.classList.toggle("active", b.dataset["7"]===state.seventh);
  });

  // ✅ 핵심: "없음"은 (ext===null && add9===false)일 때만 active
  document.querySelectorAll("[data-ext]").forEach(b=>{
    const v=b.dataset.ext;
    const isNone = (v==="none");
    const active =
      (isNone && state.ext===null && state.add9===false) ||
      (!isNone && state.ext===v);
    b.classList.toggle("active", active);
  });

  add9Btn.classList.toggle("active", state.add9);

  const extOn = state.ext !== null;
  document.querySelectorAll("[data-7]").forEach(b=>{
    const v=b.dataset["7"];
    if(extOn) addClass(b, "disabled", v!=="b7");
    else removeClass(b, "disabled");
  });

  addClass(add9Btn, "disabled", extOn);
}

function addClass(el, cls, yes){ el.classList.toggle(cls, !!yes); }
function removeClass(el, cls){ el.classList.remove(cls); }

function render(){
  applyRules();
  syncUI();
  document.getElementById("codeName").innerText = chordName();
  document.getElementById("tones").innerText = "Chord tones: " + chordTones().join(" – ");
  drawFretboard();
}

/* ---------- EVENTS ---------- */
majBtn.onclick=()=>{ state.triad="maj"; render(); };
minBtn.onclick=()=>{ state.triad="min"; render(); };

document.querySelectorAll("[data-7]").forEach(b=>{
  b.onclick=()=>{
    if(state.ext!==null) return;
    state.seventh=b.dataset["7"];
    render();
  };
});

// ✅ "없음"을 누르면 add9도 꺼짐
document.querySelectorAll("[data-ext]").forEach(b=>{
  b.onclick=()=>{
    const v=b.dataset.ext;
    if(v==="none"){
      state.ext=null;
      state.add9=false;   // ✅ 추가
      render();
      return;
    }
    state.ext = (state.ext===v ? null : v);
    render();
  };
});

add9Btn.onclick=()=>{
  if(state.ext!==null) return;
  state.add9=!state.add9;
  render();
};

render();
</script>
</body>
</html>
