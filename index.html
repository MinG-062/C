function renderFretboard(vo){
  // vo.shape는 [E, A, D, G, B, e] 순서로 들어옴(저음→고음)
  // 화면은 위→아래: e B G D A E (고음→저음) 으로 보여줘야 함
  const shapeLowToHigh = vo.shape;
  const fingersLowToHigh = vo.fingers || [0,0,0,0,0,0];

  // 화면용(고음→저음)으로 뒤집기
  const shape = [...shapeLowToHigh].reverse();     // [e, B, G, D, A, E]
  const fingers = [...fingersLowToHigh].reverse(); // [e..E]

  // 표시 프렛 범위 결정
  const fretted = shape
    .filter(x => x !== "X" && x !== 0)
    .map(x => Number(x));
  const minF = fretted.length ? Math.min(...fretted) : 1;
  const maxF = fretted.length ? Math.max(...fretted) : 4;

  const startFret = (maxF <= 4) ? 1 : minF;
  const fretCount = 5;
  const endFret = startFret + fretCount - 1;

  // SVG geometry
  const W = 720, H = 320;
  const padL = 64, padR = 26, padT = 56, padB = 34;

  const gridW = W - padL - padR;
  const gridH = H - padT - padB;

  const strings = 6;

  // ✅ 줄은 위→아래로 내려가야 하므로 "세로 간격"을 strings 기준으로
  const stringGapY = gridH / (strings - 1);

  // ✅ 프렛은 왼→오로 증가하므로 "가로 간격"을 fretCount 기준으로
  const fretGapX = gridW / fretCount;

  // 좌표 변환
  const sy = (i) => padT + i * stringGapY;     // string y (0..5) : 0이 1번줄(e)
  const fx = (f) => padL + f * fretGapX;       // fret line x (0..fretCount)

  const ns = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(ns,"svg");
  svg.setAttribute("viewBox", `0 0 ${W} ${H}`);

  // 프렛(세로선) - 왼쪽이 nut/1fr 영역
  for (let f=0; f<=fretCount; f++){
    const x = fx(f);
    const line = document.createElementNS(ns,"line");
    line.setAttribute("x1", x);
    line.setAttribute("x2", x);
    line.setAttribute("y1", padT);
    line.setAttribute("y2", padT + gridH);
    line.setAttribute("stroke", "rgba(232,234,240,.22)");
    line.setAttribute("stroke-width", (startFret===1 && f===0) ? "5" : "2"); // nut 두껍게
    line.setAttribute("stroke-linecap", "round");
    svg.appendChild(line);
  }

  // 줄(가로선)
  for (let s=0; s<strings; s++){
    const y = sy(s);
    const line = document.createElementNS(ns,"line");
    line.setAttribute("x1", padL);
    line.setAttribute("x2", padL + gridW);
    line.setAttribute("y1", y);
    line.setAttribute("y2", y);
    line.setAttribute("stroke", "rgba(232,234,240,.18)");
    line.setAttribute("stroke-width", "2");
    line.setAttribute("stroke-linecap", "round");
    svg.appendChild(line);
  }

  // 줄 라벨 (위→아래: e B G D A E)
  const labels = ["e","B","G","D","A","E"];
  for (let s=0;s<strings;s++){
    const t = document.createElementNS(ns,"text");
    t.setAttribute("x", String(padL - 28));
    t.setAttribute("y", String(sy(s) + 5));
    t.setAttribute("fill","rgba(167,173,187,.9)");
    t.setAttribute("font-size","12");
    t.setAttribute("font-weight","900");
    t.textContent = labels[s];
    svg.appendChild(t);
  }

  // 시작 프렛 표기(1fr이 아닐 때)
  if (startFret !== 1){
    const t = document.createElementNS(ns,"text");
    t.setAttribute("x", String(padL));
    t.setAttribute("y", String(padT - 20));
    t.setAttribute("fill","rgba(167,173,187,.9)");
    t.setAttribute("font-size","12");
    t.setAttribute("font-weight","900");
    t.textContent = `${startFret}fr`;
    svg.appendChild(t);
  }

  // ✅ 프렛 번호 (왼→오)
  for (let f=1; f<=fretCount; f++){
    const num = startFret + (f-1);
    const t = document.createElementNS(ns,"text");
    t.setAttribute("x", String(fx(f-0.5)));
    t.setAttribute("y", String(padT + gridH + 22));
    t.setAttribute("text-anchor","middle");
    t.setAttribute("fill","rgba(167,173,187,.75)");
    t.setAttribute("font-size","11");
    t.setAttribute("font-weight","800");
    t.textContent = String(num);
    svg.appendChild(t);
  }

  // X / O 표시 (nut 왼쪽 위가 아니라, 각 줄의 "프렛 0 영역" 위에)
  for (let s=0; s<strings; s++){
    const v = shape[s];
    if (v !== "X" && v !== 0) continue;

    const t = document.createElementNS(ns,"text");
    t.setAttribute("x", String(padL - 18));
    t.setAttribute("y", String(sy(s) + 5));
    t.setAttribute("text-anchor","middle");
    t.setAttribute("font-size","14");
    t.setAttribute("font-weight","900");
    t.setAttribute("fill", v==="X" ? "rgba(255,209,102,.95)" : "rgba(139,245,193,.95)");
    t.textContent = (v==="X") ? "X" : "O";
    svg.appendChild(t);
  }

  // Barre (캡슐) - 좌우로 눌러서 표시
  if (vo.barre){
    // barre는 원래 low-to-high 기준(from/to)이 들어있으니 화면 기준으로 변환
    // low-to-high index: 0(E)..5(e)
    // 화면 index: 0(e)..5(E) => screen = 5 - original
    const { fret, from, to, finger } = vo.barre;
    const fromS = 5 - from;
    const toS   = 5 - to;

    if (fret >= startFret && fret <= endFret){
      const localF = fret - startFret; // 0..4
      // 프렛 칸 중앙 x
      const cx = fx(localF) + fretGapX/2;

      const y1 = sy(Math.min(fromS,toS));
      const y2 = sy(Math.max(fromS,toS));

      const rect = document.createElementNS(ns,"rect");
      rect.setAttribute("x", String(cx - 13));
      rect.setAttribute("y", String(y1 - 14));
      rect.setAttribute("width", "26");
      rect.setAttribute("height", String((y2 - y1) + 28));
      rect.setAttribute("rx","13");
      rect.setAttribute("fill","rgba(255,209,102,.18)");
      rect.setAttribute("stroke","rgba(255,209,102,.55)");
      rect.setAttribute("stroke-width","2");
      svg.appendChild(rect);

      const txt = document.createElementNS(ns,"text");
      txt.setAttribute("x", String(cx));
      txt.setAttribute("y", String(y1 - 20));
      txt.setAttribute("text-anchor","middle");
      txt.setAttribute("fill","rgba(255,209,102,.95)");
      txt.setAttribute("font-size","12");
      txt.setAttribute("font-weight","900");
      txt.textContent = String(finger);
      svg.appendChild(txt);
    }
  }

  // Finger dots + numbers
  for (let s=0; s<strings; s++){
    const v = shape[s];
    if (v==="X" || v===0) continue;

    const fret = Number(v);
    if (fret < startFret || fret > endFret) continue;

    const localF = fret - startFret;
    const cx = fx(localF) + fretGapX/2;
    const cy = sy(s);

    const dot = document.createElementNS(ns,"circle");
    dot.setAttribute("cx", String(cx));
    dot.setAttribute("cy", String(cy));
    dot.setAttribute("r", "13");
    dot.setAttribute("fill", "rgba(139,245,193,.92)");
    dot.setAttribute("stroke", "rgba(0,0,0,.25)");
    dot.setAttribute("stroke-width", "2");
    svg.appendChild(dot);

    const fnum = Number(fingers[s] || 0);
    if (fnum > 0){
      const t = document.createElementNS(ns,"text");
      t.setAttribute("x", String(cx));
      t.setAttribute("y", String(cy + 5));
      t.setAttribute("text-anchor","middle");
      t.setAttribute("fill", "rgba(0,0,0,.75)");
      t.setAttribute("font-size","13");
      t.setAttribute("font-weight","900");
      t.textContent = String(fnum);
      svg.appendChild(t);
    }
  }

  return svg;
}
